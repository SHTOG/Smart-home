## 自定义指令(中控与终端)

本套指令格式用于无线传输的数据

### 数据帧格式(hex格式)

| 帧头        | 自身长地址              | 命令码(设备类型码) | 有效数据长度 | 有效数据 | 回车  |
| ----------- | ----------------------- | ------------------ | ------------ | -------- | ----- |
| C1 C2 C3 C4 | XX XX XX XX XX XX XX XX | AA                 | YY           | ZZ ZZ……  | 0D 0A |
| 4字节       | 8字节                   | 1字节              | 1字节        | ≥0       | 2字节 |

ps：命令码同时也是设备类型码（除了0x00和0xFF）

### 设备类型码表

| 具体设备中文名 | 对应码十六进制 |
| -------------: | -------------- |
|           电灯 | 0x01           |
|           空调 | 0x02           |
|           窗帘 | 0x03           |
|           门锁 | 0x04           |
|           音响 | 0x05           |
|                |                |
|                |                |
|                |                |
|                |                |



### 设备应答命令0xFF

有效数据内容

| 应答信息                                |
| --------------------------------------- |
| 2字节<br />普通应答['O' 'K'(0x4F 0x4B)] |

例：（发出应答设备长地址70 E4 61 25 00 4B 12 00）

请求应答：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 FF 00 0D 0A

设备应答ok：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 FF 02 4F 4B 0D 0A

设备应答（密文）:

### 设备信息命令0x00

**有效数据内容**

| 命令源设备类型码 | 短地址 |
| :--------------- | :----- |
| 1字节            | 2字节  |

例：（长地址为17 48 9E 19 00 4B 12 00、短地址为A5 49）

发送电灯控制器终端的信息：C1 C2 C3 C4 17 48 9E 19 00 4B 12 00 00 03 01 A5 49 0D 0A

### 电灯控制命令0x01

**有效数据内容**

| 目标电灯号              | 控制命令码 |
| ----------------------- | ---------- |
| 1字节（00表示对所有灯） | 1~2字节    |



例：（中控长地址为70 E4 61 25 00 4B 12 00）

关灯(灯泡断电)：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 01 02 01 00 0D 0A

开灯(灯泡上电)：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 01 02 01 01 0D 0A

亮度+：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 01 02 01 02 0D 0A

亮度-：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 01 02 01 03 0D 0A

亮度调至指定档位：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 01 03 01 04 XX 0D 0A（XX为档位）(档位为0~10) 
这里我对APP有个建议就是设立一个"亮度条"，分0~11个结点，拉到哪个节点就发送对应档位指令，一被拉动就发送，可以体现“高灵敏”

进入普通模式：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 01 02 01 05 0D 0A

所有灯进入普通模式：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 01 02 00 05 0D 0A

进入呼吸灯模式：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 01 02 01 06 0D 0A

所有灯进入同步呼吸模式：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 01 02 00 06 0D 0A

### 空调控制命令0x02

**有效数据内容**

|                           有效数据                           |
| :----------------------------------------------------------: |
| 若是温湿度采集信息：3字节，前两字节为温度信息（前一位是整数部分，后一位是小数部分（1位小数）），后一字节为湿度信息<br />若是空调控制指令，前一字节为开0x01/关0x00指定功能，后一字节为指定功能 |

例：（中控长地址为70 E4 61 25 00 4B 12 00）

返回温度为23.3℃（）、湿度为90%：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 02 03 17 03 5A 0D 0A

打开制冷模式：                        C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 02 02 01 01 0D 0A

关闭制冷模式：                        C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 02 02 00 01 0D 0A

### 窗帘控制命令0x03

**有效数据内容**

|                       控制命令码                       |
| :----------------------------------------------------: |
| 1字节（开到的指定程度(0~0x80) 0x00为全关，0x80为全开） |

例：中控长地址为70 E4 61 25 00 4B 12 00

全关：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 03 01 00 0D 0A

开到16/128：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 03 01 10 0D 0A

全开：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 03 01 80 0D 0A

## 自定义指令(中控与ESP32)

### 数据帧格式(hex格式)

| 帧头        |     通信中控长地址      | 目标短地址 | 命令码(设备类型码) | 有效数据长度 | 有效数据 | 回车(帧尾) |
| ----------- | :---------------------: | ---------- | ------------------ | ------------ | -------- | ---------- |
| A1 A2 A3 A4 | xx xx xx xx xx xx xx xx | XX XX      | AA                 | YY           | ZZ ZZ……  | 0D 0A      |
| 4字节       |          8字节          | 2字节      | 1字节              | 1字节        | 0~20字节 | 2字节      |

ps：数据帧发送目标如果是Esp（即APP）则目标短地址是数据帧来源的短地址；如果是对应终端，则是该终端的短地址
       命令码同时也是设备类型码（除了0x00和0xFF）

**以下所有例子中通信中控的长地址都为(70 E4 61 25 00 4B 12 00)**

### 设备类型码表

| 具体设备中文名 | 对应码十六进制 |
| -------------: | -------------- |
|           电灯 | 0x01           |
|           空调 | 0x02           |
|           窗帘 | 0x03           |
|           门锁 | 0x04           |
|           音响 | 0x05           |
|                |                |
|                |                |
|                |                |
|                |                |



### 设备应答命令0xFF

有效数据内容

| 应答信息(esp与中控间应答数据的短地址统一为00 00)             |
| ------------------------------------------------------------ |
| 2/10字节<br />普通应答['O' 'K'(0x4F 0x4B)]<br />数据流结束提示['E' 'N' 'D'(0x69 0x78 0x68)]<br />来自APP的拒绝终端入网应答[0x00 0x00]<br />来自APP的同意终端入网应答[0x00 0x01]<br />来自APP的开放入网信号[0x00 0x02]<br />来自APP的请求获取所有入网终端的状态的指令[0x00 0x03]<br />APP删除指定终端[0x00 0x04 xx xx xx xx xx xx xx xx]\(x为指定终端长地址) |

例：

双向通用应答：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FF 02 4F 4B 0D 0A

ESP32数据流结束应答给APP：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FF 03 4F 4B 0D 0A

APP拒绝当前申请的终端入网：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FF 02 00 00 0D 0A

APP同意当前申请的终端入网：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FF 02 00 01 0D 0A

APP开放入网：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FF 02 00 02 0D 0A

APP请求获取所有入网终端的状态(APP启动第一件事就是发这条指令)：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FF 02 00 03 0D 0A

APP删除指定终端(假定删除目标终端长地址为17 48 9E 19 00 4B 12 00)：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FF 0A 00 04 17 48 9E 19 00 4B 12 00 0D 0A

### 设备信息命令0x00

**有效数据内容**

| 命令源设备类型码 | 入网标志（0-未入网，1-已入网） | 设备长地址 | 设备短地址 |
| :--------------- | :----------------------------- | ---------- | ---------- |
| 1字节            | 1字节                          | 8字节      | 2字节      |

例：（设备类型为01、入网标志为1、长地址为17 48 9E 19 00 4B 12 00、短地址为A5 49）

向APP发送电灯控制器终端的信息：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 00 0C 01 01 17 48 9E 19 00 4B 12 00 A5 49 0D 0A

### 电灯控制命令0x01

**有效数据内容**

| 目标电灯号              | 控制命令码 |
| ----------------------- | ---------- |
| 1字节（00表示对所有灯） | 1~2字节    |

例：（假定目标灯泡终端短地址为0x1111）

关灯(灯泡断电)：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 11 11 01 02 01 00 0D 0A

开灯(灯泡上电)：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 11 11 01 02 01 01 0D 0A

亮度+：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 11 11 01 02 01 02 0D 0A

亮度-：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 11 11 01 02 01 03 0D 0A

亮度调至指定档位：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 11 11 01 03 01 04 XX 0D 0A（XX为档位）(档位为0~10) 
这里我对APP有个建议就是设立一个"亮度条"，分0~10个结点，拉到哪个节点就发送对应档位指令，一被拉动就发送，可以体现“高灵敏”

进入普通模式（退出呼吸灯模式）：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 11 11 01 02 01 05 0D 0A

所有灯进入普通模式：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 11 11 01 02 00 05 0D 0A

进入呼吸灯模式：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 11 11 01 02 01 06 0D 0A

所有灯进入同步呼吸模式：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 11 11 01 02 00 06 0D 0A

### 空调控制命令0x02

**有效数据内容**

|                           有效数据                           |
| :----------------------------------------------------------: |
| 若是温湿度采集信息：3字节，前两字节为温度信息（前一位是整数部分，后一位是小数部分（1位小数）），后一字节为湿度信息<br />若是空调控制指令，前一字节为开0x01/关0x00指定功能，后一字节为指定功能 |

例：空调终端短地址为 A5 49

返回温度为23.3℃（）、湿度为90%：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 02 03 17 03 5A 0D 0A

打开制冷模式：                         A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 02 02 01 01 0D 0A

关闭制冷模式：                         A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 02 02 00 01 0D 0A

### 窗帘控制命令0x03

**有效数据内容**

|              控制命令码               |
| :-----------------------------------: |
| 1字节（对应的CurtainDeep）(0x00~0x80) |

例：目标窗帘短地址为 A5 49

关：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 03 01 00 0D 0A

开：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 03 01 80 0D 0A

指定Deep：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 03 01 xx 0D 0A
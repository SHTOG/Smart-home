## 自定义指令(中控与终端)

本套指令格式用于无线传输的数据

### 数据帧格式(hex格式)

| 帧头        | 自身长地址              | 命令码(设备类型码) | 有效数据长度 | 有效数据 | 回车  |
| ----------- | ----------------------- | ------------------ | ------------ | -------- | ----- |
| C1 C2 C3 C4 | XX XX XX XX XX XX XX XX | AA                 | YY           | ZZ ZZ……  | 0D 0A |
| 4字节       | 8字节                   | 1字节              | 1字节        | ≥0       | 2字节 |

ps：命令码同时也是设备类型码（除了0x00和0xFF）

### 设备类型码表

| 具体设备中文名 | 对应码十六进制 |
| -------------: | -------------- |
|           电灯 | 0x01           |
|           空调 | 0x02           |
|           窗帘 | 0x03           |
| 空调专用传感器 | 0x04           |
| 独立温度传感器 | 0x05           |
| 独立湿度传感器 | 0x06           |
|     烟雾传感器 | 0x07           |
|                |                |
|                |                |



### 设备应答命令0xFF

有效数据内容

| 应答信息                                |
| --------------------------------------- |
| 2字节<br />普通应答['O' 'K'(0x4F 0x4B)] |

例：（发出应答设备长地址70 E4 61 25 00 4B 12 00）

请求应答：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 FF 00 0D 0A

设备应答ok：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 FF 02 4F 4B 0D 0A

设备应答（密文）:

### 设备信息命令0x00

**有效数据内容**

| 命令源设备类型码 | 短地址 |
| :--------------- | :----- |
| 1字节            | 2字节  |

例：（长地址为17 48 9E 19 00 4B 12 00、短地址为A5 49）

发送电灯控制器终端的信息：C1 C2 C3 C4 B4 FD 65 25 00 4B 12 00 00 03 01 2D B8 0D 0A

### 电灯控制命令0x01

**有效数据内容**

| 目标电灯号              | 控制命令码 |
| ----------------------- | ---------- |
| 1字节（00表示对所有灯） | 1~2字节    |



例：（中控长地址为70 E4 61 25 00 4B 12 00）

关灯(灯泡断电)：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 01 02 01 00 0D 0A

开灯(灯泡上电)：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 01 02 01 01 0D 0A

亮度+：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 01 02 01 02 0D 0A

亮度-：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 01 02 01 03 0D 0A

亮度调至指定档位：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 01 03 01 04 XX 0D 0A（XX为档位）(档位为0~10) 
这里我对APP有个建议就是设立一个"亮度条"，分0~11个结点，拉到哪个节点就发送对应档位指令，一被拉动就发送，可以体现“高灵敏”

进入普通模式：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 01 02 01 05 0D 0A

所有灯进入普通模式：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 01 02 00 05 0D 0A

进入呼吸灯模式：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 01 02 01 06 0D 0A

所有灯进入同步呼吸模式：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 01 02 00 06 0D 0A

### 空调控制命令0x02

**有效数据内容**

|                    有效数据                    |
| :--------------------------------------------: |
| 空调的红外数据，简单来说就是67个0x00和0x01组成 |

例：（中控长地址为70 E4 61 25 00 4B 12 00）

打开制冷模式：                        C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 A5 49 02 4D xx xx…… 0D 0A

### 窗帘控制命令0x03

**有效数据内容**

|                       控制命令码                       |
| :----------------------------------------------------: |
| 1字节（开到的指定程度(0~0x80) 0x00为全关，0x80为全开） |

例：中控长地址为70 E4 61 25 00 4B 12 00
       窗帘长地址为17 48 9E 19 00 4B 12 00



全关：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 03 01 00 0D 0A

开到16/128：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 03 01 10 0D 0A

全开：C1 C2 C3 C4 70 E4 61 25 00 4B 12 00 03 01 80 0D 0A

返回打开程度值0x23：C1 C2 C3 C4 17 48 9E 19 00 4B 12 00 03 01 23 0D 0A

### 空调专用温湿度传感器0x04

|                           有效数据                           |
| :----------------------------------------------------------: |
| 3字节，前两字节为温度信息（前一位是整数部分，后一位是小数部分（1位小数）），后一字节为湿度信息 |

例：传感器长地址：17 48 9E 19 00 4B 12 00

返回温度为23.3℃、湿度为90%：C1 C2 C3 C4 17 48 9E 19 00 4B 12 00 04 03 17 03 5A 0D 0A

### 独立温度传感器0x05

**有效数据内容**

|                         有效数据                         |
| :------------------------------------------------------: |
| 2字节，（前一位是整数部分，后一位是小数部分（1位小数）） |

例：数据源终端短地址为 A5 49

返回温度为23.3℃：C1 C2 C3 C4 17 48 9E 19 00 4B 12 00 05 02 17 03 0D 0A

### 独立湿度传感器0x06

**有效数据内容**

|      有效数据       |
| :-----------------: |
| 1字节（湿度百分比） |

例：传感器终端短地址为 A5 49

返回湿度为90℃：C1 C2 C3 C4 17 48 9E 19 00 4B 12 00 A5 49 05 01 5A 0D 0A

### 烟雾传感器0x07

**有效数据内容**

|        有效数据         |
| :---------------------: |
| 1字节（烟雾浓度百分比） |

例：传感器终端短地址为 A5 49

返回烟雾浓度为90℃：C1 C2 C3 C4 17 48 9E 19 00 4B 12 00 A5 49 05 01 5A 0D 0A

## 自定义指令(中控与ESP32)

### 数据帧格式(hex格式)

| 帧头        |     通信中控长地址      | 目标短地址 | 命令码(设备类型码) | 有效数据长度 | 有效数据 | 回车(帧尾) |
| ----------- | :---------------------: | ---------- | ------------------ | ------------ | -------- | ---------- |
| A1 A2 A3 A4 | xx xx xx xx xx xx xx xx | XX XX      | AA                 | YY           | ZZ ZZ……  | 0D 0A      |
| 4字节       |          8字节          | 2字节      | 1字节              | 1字节        | 0~20字节 | 2字节      |

ps：数据帧发送目标如果是Esp（即APP）则目标短地址是数据帧来源的短地址；如果是对应终端，则是该终端的短地址
       命令码同时也是设备类型码（除了0x00和0xFF）

**以下所有例子中通信中控的长地址都为(70 E4 61 25 00 4B 12 00)**

### 设备类型码表

| 具体设备中文名 | 对应码十六进制 |
| -------------: | -------------- |
|           电灯 | 0x01           |
|           空调 | 0x02           |
|           窗帘 | 0x03           |
| 空调专用传感器 | 0x04           |
| 独立温度传感器 | 0x05           |
| 独立湿度传感器 | 0x06           |
|     烟雾传感器 | 0x07           |
|           门锁 | 0x08           |
|         加湿器 | 0x09           |



### 设备应答命令0xFF

有效数据内容

| 应答信息(esp与中控间应答数据的短地址统一为00 00)             |
| ------------------------------------------------------------ |
| 2~10字节<br />普通应答['O' 'K'(0x4F 0x4B)]<br />数据流结束提示['E' 'N' 'D'(0x69 0x78 0x68)]<br />来自APP的拒绝终端入网应答[0x00 0x00]<br />来自APP的同意终端入网应答[0x00 0x01]<br />来自APP的开放入网信号[0x00 0x02]<br />来自APP的请求获取所有入网终端的状态的指令[0x00 0x03]<br />APP删除指定终端[0x00 0x04 xx xx xx xx xx xx xx xx]\(x为指定终端长地址) |

例：

双向通用应答：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FF 02 4F 4B 0D 0A

ESP32数据流结束应答给APP：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FF 03 4F 4B 0D 0A

APP拒绝当前申请的终端入网：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FF 02 00 00 0D 0A

APP同意当前申请的终端入网：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FF 02 00 01 0D 0A

APP开放入网：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FF 02 00 02 0D 0A

APP请求获取所有入网终端的状态(APP启动第一件事就是发这条指令)：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FF 02 00 03 0D 0A

APP删除指定终端(假定删除目标终端长地址为17 48 9E 19 00 4B 12 00)：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FF 0A 00 04 17 48 9E 19 00 4B 12 00 0D 0A

### 场景设置命令0xFE

**有效数据内容**

| 场景操作选择位                                               | 场景名长度                     | 场景名                                            | 内嵌有效数据长度                                             | 内嵌有效数据数据                                             |
| ------------------------------------------------------------ | :----------------------------- | ------------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1字节                                                        | 1字节                          | 18字节                                            | 1字节                                                        | n字节                                                        |
| 如果是APP发向中控：<br />（0x00删除指定场景、0x01创建指定场景、<br />0x02场景删除条件、0x03场景增加条件、<br />0x04场景删除指令、0x05场景增加指令、<br />0x06场景禁用指令、0x07场景启用指令)<br />0x08APP请求获取中控存储的所有场景信息（这个比较特殊，如果是这个命令的话，有效数据内容就只有这个0x08）<br />如果是中控发向APP：0x01创建指定场景<br />0x03场景增加条件<br />0x05场景增加指令<br />0x06场景禁用指令<br />0x07场景启用指令 | 用于指示程序场景名的长度(字节) | 用户设定的场景名<br />（最多6个中文或者18个英文） | 对场景的删减和启用禁用操作固定为0x00<br />对条件和对指令的增减操作根据需求变化 | 如果是传感器条件：传感数据源设备长地址+大于或小于标志位（大于为1，小于为0）+ 传感数据<br />如果是时间条件：中控长地址+定时执行或时间段执行（定时执行为0，时间段内执行为1）+ 定时执行的时分或时间段的时分秒时分秒<br />如果是指令：对应终端短地址+命令码+有效数据长度+有效数据 |

例：
指令=A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FE 15 00 12 E5 86 AC E5 A4 A9 E5 87 86 E5 A4 87 E5 9B 9E E5 AE B6 00 0D 0A
描述=删除后场景“冬天准备回家”

指令=A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FE 15 01 12 E5 86 AC E5 A4 A9 E5 87 86 E5 A4 87 E5 9B 9E E5 AE B6 00 0D 0A
描述=创建场景“冬天准备回家”

指令=A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FE 20 02 12 E5 86 AC E5 A4 A9 E5 87 86 E5 A4 87 E5 9B 9E E5 AE B6 0B 17 48 9E 19 00 4B 12 00 00 17 00 0D 0A
描述=删除场景“冬天准备回家”的条件{"室内温度低于23℃"}（假定温度传感器长地址为17 48 9E 19 00 4B 12 00）

指令=A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FE 20 03 12 E5 86 AC E5 A4 A9 E5 87 86 E5 A4 87 E5 9B 9E E5 AE B6 0B 17 48 9E 19 00 4B 12 00 00 17 00 0D 0A
描述=增加场景“冬天准备回家”的条件{"室内温度低于23℃"}（假定温度传感器长地址为17 48 9E 19 00 4B 12 00）

指令=A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FE 1A 04 12 E5 86 AC E5 A4 A9 E5 87 86 E5 A4 87 E5 9B 9E E5 AE B6 05 02 02 03 01 80 0D 0A
描述=删除场景“冬天准备回家”的指令{"打开客厅窗帘"}（假定窗帘短地址为02 02）

指令=A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FE 1A 05 12 E5 86 AC E5 A4 A9 E5 87 86 E5 A4 87 E5 9B 9E E5 AE B6 05 02 02 03 01 80 0D 0A
描述=增加场景“冬天准备回家”的指令{"打开客厅窗帘"}（假定窗帘短地址为02 02）

指令=A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FE 15 06 12 E5 86 AC E5 A4 A9 E5 87 86 E5 A4 87 E5 9B 9E E5 AE B6 00 0D 0A
描述=禁用场景“冬天准备回家”

指令=A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FE 15 07 12 E5 86 AC E5 A4 A9 E5 87 86 E5 A4 87 E5 9B 9E E5 AE B6 00 0D 0A
描述=启用场景“冬天准备回家”

指令=A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FE 20 03 12 E5 86 AC E5 A4 A9 E5 87 86 E5 A4 87 E5 9B 9E E5 AE B6 xx 70 E4 61 25 00 4B 12 00 00 13 0F 0D 0A
描述=增加场景“冬天准备回家”的条件{"时间19时15分执行"}

指令=A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FE 20 03 12 E5 86 AC E5 A4 A9 E5 87 86 E5 A4 87 E5 9B 9E E5 AE B6 xx 70 E4 61 25 00 4B 12 00 01 0D 0F 0D 0A
描述=增加场景“冬天准备回家”的条件{"时间13时14分20秒到20时0分0秒执行"}

指令=A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FE 01 08 0D 0A

### 时间校准命令0xFD

**有效数据内容**

|                           有效数据                           |
| :----------------------------------------------------------: |
| 3字节 \[0xXX 0xYY 0xZZ 0xAA 0xBB 0xCC\]\[X->时 Y->分 Z->秒 A->年的后两位 B->月 C->日\] |

ESP32把实时的北京时间发给中控（13:14:52 23年4月10日）：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 FD 06 0D 0E 34 17 04 0A 0D 0A



### 设备数据命令0xFC

### 设备信息命令0x00

**有效数据内容**

- 如果有效数据第一位不为0

  | 命令源设备类型码 | 在线状态标志 | 设备长地址 | 设备短地址 | 设备反馈数据               |
  | :--------------- | :----------- | ---------- | ---------- | -------------------------- |
  | 1字节            | 1字节        | 8字节      | 2字节      | 不定(根据具体设备类型决定) |
  
  |      设备类型       |         设备反馈数据          |
  | :-----------------: | :---------------------------: |
  |      0x01电灯       |              无               |
  |      0x02空调       | 7字节（上次控制后空调的状态） |
  |      0x03窗帘       |     1字节（窗帘打开程度）     |
  | 0x04~0x07各种传感器 |              无               |
  |        0x08         |             未定              |
  |                     |                               |
  
  
  
- 如果有效数据第一位为0

  | 区分上面的指令用的标志位(固定0x00) | 指定终端长地址 | 自定义空间名长度'n(0~18)' | 自定义空间名(utf-8) | 序号(0~255) |
  | ---------------------------------- | -------------- | ------------------------- | ------------------- | ----------- |
  | 1字节                              | 8字节          | 1字节                     | n(0~18)字节         | 1字节       |

例：（举例终端长地址为17 48 9E 19 00 4B 12 00）

向APP发送灯控终端的信息（设备类型为01、在线、短地址为A5 49）：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 00 0C 01 01 17 48 9E 19 00 4B 12 00 A5 49 0D 0A

向APP发送窗帘控制终端的信息（设备类型为01、在线、短地址为A5 49、设备反馈数据为0x23）：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 00 0D 01 01 17 48 9E 19 00 4B 12 00 A5 49 23 0D 0A

APP向中控发送指定长地址设备的“定位”（空间名为"my客厅"、序号为1）：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 00 00 00 13 00 17 48 9E 19 00 4B 12 00 08 6D 79 E5 AE A2 E5 8E 85 01 0D 0A

### 电灯控制命令0x01

**有效数据内容**

| 目标电灯号              | 控制命令码 |
| ----------------------- | ---------- |
| 1字节（00表示对所有灯） | 2~3字节    |

例：（假定目标灯泡终端短地址为0x1111）

亮度调至指定档位：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 11 11 01 03 01 04 XX 0D 0A（XX为档位）(档位为0~10) 
这里我对APP有个建议就是设立一个"亮度条"，分0~10个结点，拉到哪个节点就发送对应档位指令，一被拉动就发送，可以体现“高灵敏”

进入普通模式（退出呼吸灯模式）：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 11 11 01 02 01 05 0D 0A

所有灯进入普通模式：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 11 11 01 02 00 05 0D 0A

进入呼吸灯模式：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 11 11 01 02 01 06 0D 0A

所有灯进入同步呼吸模式：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 11 11 01 02 00 06 0D 0A

### 空调控制命令0x02

**有效数据内容**

| 控制命令码 |              附带数据               |
| :--------: | :---------------------------------: |
|   1字节    | 0~1字节(具体的温度、风速、定时时长) |

例：空调终端短地址为 A5 49

关机：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 03 01 00 0D 0A

开机：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 03 01 01 0D 0A

制暖：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 03 01 02 0D 0A

制冷：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 03 01 03 0D 0A

加湿：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 03 01 04 0D 0A

送风：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 03 01 05 0D 0A

自动：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 03 01 06 0D 0A

风速高：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 03 02 07 03 0D 0A（自动为00，低中高分别是01 02 03）

温度30℃：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 03 02 08 1E 0D 0A

定时数据：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 03 01 09 0D 0A（无法实现）

上下扫风开：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 03 01 0A 0D 0A

上下扫风关：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 03 01 0B 0D 0A



### 窗帘控制命令0x03

**有效数据内容**

|              控制命令码               |
| :-----------------------------------: |
| 1字节（对应的CurtainDeep）(0x00~0x80) |

例：目标窗帘短地址为 A5 49

关：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 03 01 00 0D 0A

开：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 03 01 80 0D 0A

指定Deep：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 03 01 xx 0D 0A

### 空调专用温湿度传感器0x04

**有效数据内容**

|                           有效数据                           |
| :----------------------------------------------------------: |
| 3字节，前两字节为温度信息（前一位是整数部分，后一位是小数部分（1位小数）），后一字节为湿度信息 |

例：数据源终端短地址为 A5 49

返回温度为23.3℃、湿度为90%：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 04 03 17 03 5A 0D 0A

### 独立温度传感器0x05

**有效数据内容**

|                         有效数据                         |
| :------------------------------------------------------: |
| 2字节，（前一位是整数部分，后一位是小数部分（1位小数）） |

例：传感器终端短地址为 A5 49

返回温度为23.3℃：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 05 02 17 03 0D 0A

### 独立湿度传感器0x06

**有效数据内容**

|      有效数据       |
| :-----------------: |
| 1字节（湿度百分比） |

例：传感器终端短地址为 A5 49

返回湿度为90℃：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 06 01 5A 0D 0A

### 烟雾传感器0x07

**有效数据内容**

|        有效数据         |
| :---------------------: |
| 1字节（烟雾浓度百分比） |

例：传感器终端短地址为 A5 49

返回烟雾浓度为90℃：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 07 01 5A 0D 0A

### 门锁控制命令0x08

**有效数据内容**

|                          控制命令码                          |
| :----------------------------------------------------------: |
| 1字节(00关锁 01开锁 02门锁被输密码打开 03门锁被人脸解锁 04门锁被指纹解锁) |

例：门锁终端短地址为 A5 49

APP关锁：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 08 01 00 0D 0A

APP开锁：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 08 01 01 0D 0A

门锁被输密码打开，返回数据给中控A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 08 01 02 0D 0A

门锁被人脸解锁，返回数据给中控A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 08 01 03 0D 0A

门锁被指纹解锁，返回数据给中控A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 08 01 04 0D 0A

### 加湿器控制命令0x09

**有效数据内容**

|    有效数据     |
| :-------------: |
| 1字节(控制命令) |

例：加湿器终端短地址为 A5 49

关闭喷雾：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 09 01 00 0D 0A

开始喷雾：A1 A2 A3 A4 70 E4 61 25 00 4B 12 00 A5 49 09 01 01 0D 0A